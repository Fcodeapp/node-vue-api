import{r as v,a as G,b as g,o as m,i as C,w as o,e as T,f as t,g as k,c as h,h as L,F as R,m as J,j as q,E as c,p as K,t as F,q as X}from"./index-bac9a75a.js";import{_ as Y}from"./Pagination-9c7ed825.js";const Z="/assets/pro_dripBagBag-c35f7ea1.png",ee="/assets/pro_dripBagPacket-d2b7a441.png",le="/assets/pro_singleOrigin-f2b6c288.png",te={class:"dialog-footer"},p="140px",ae={__name:"Dialog",props:{visible:{type:Boolean,default:!1},title:{type:String},data:{type:Object}},emits:["close","submitEdit","submitAdd"],setup(A,{emit:M}){const i=A,S=M,O=v(),a=G((()=>(console.log(i.data),i.data?{name:i.data.name,status:i.data.status,type:i.data.type,describe:i.data.describe,cost:i.data.cost,retail:i.data.retail,discount:i.data.discount,directions:i.data.directions,weight:i.data.weight,ingredient:i.data.ingredient,nutritionFacts:i.data.nutritionFacts,exp:i.data.exp,img:i.data.img,popular:i.data.popular,style:i.data.style,order:i.data.order,remark:i.data.remark}:{name:"",status:"1",type:"",describe:"",cost:"0",retail:"0",discount:"0",directions:"包裝過程充氮+脫氧劑【充氮氣包裝】尚殘留4~6%的氧氣加入脫氧劑將剩餘氧氣完全吸收",preserve:`
      1.因採新鮮烘培,最佳放置於冰箱恆溫冷藏(密封)，避免陽光直射或高溫潮濕處
      2.開封後請盡速飲用完畢
      `,weight:"",ingredient:"100% 莊園豆研磨 (無食品添加物)",nutritionFacts:"",exp:"現烘嚐鮮期30天 保存期限45天",img:"",popular:!0,style:"0",order:"1",remark:""}))()),w=(f,l,n)=>{Number.isInteger(Number(l))||n(new Error("請輸入數值")),Number(l)>Number(a.retail)?n(new Error("折扣價不得大於售價")):n()},B=(f,l,n)=>{Number.isInteger(Number(l))?n():n(new Error("請輸入數值"))},x=G({name:[{required:!0,message:"請輸入商品名稱",trigger:"blur"},{max:20,message:"字數不得超過20",trigger:"blur"}],status:[{required:!0,message:"請選擇商品狀態",trigger:"blur"}],type:[{required:!0,message:"請輸入商品類型",trigger:"change"}],describe:[{max:20,message:"字數不得超過20",trigger:"blur"}],cost:[{required:!0,message:"請輸入商品成本",trigger:"blur"},{validator:B,trigger:"blur"}],retail:[{required:!0,message:"請輸入商品售價",trigger:"blur"},{validator:B,trigger:"blur"}],discount:[{validator:w,trigger:"blur"}]}),E=v([{value:"pro_singleOrigin",label:"單品咖啡"},{value:"pro_dripBagBag",label:"濾掛咖啡綜合補充包"},{value:"pro_dripBagPacket",label:"濾掛咖啡盒裝"}]),N=v([{label:"coffee",value:"0"},{label:"purple",value:"1"},{label:"green",value:"2"},{label:"orange",value:"3"},{label:"yellow",value:"4"},{label:"blue",value:"5"},{label:"pink",value:"6"}]),y=f=>{console.log(f);const l=E.value.find(n=>n.label===f);l&&(a.img=l.value)},$=()=>{S("close")},j=async f=>{f&&await f.validate((l,n)=>{l?(console.log(a),i.data?S("submitEdit",a):S("submitAdd",a)):console.log("error submit!",n)})};return(f,l)=>{const n=g("el-input"),d=g("el-form-item"),U=g("el-radio"),P=g("el-radio-group"),z=g("el-option"),D=g("el-select"),I=g("el-form"),r=g("el-button"),s=g("el-dialog");return m(),C(s,{"model-value":i.visible,title:A.title,"show-close":!1,"close-on-press-escape":!1},{footer:o(()=>[T("span",te,[t(r,{onClick:$},{default:o(()=>[k("取消")]),_:1}),t(r,{onClick:l[18]||(l[18]=e=>j(O.value)),type:"primary"},{default:o(()=>[k(" 送出 ")]),_:1})])]),default:o(()=>[t(I,{ref_key:"formRef",ref:O,model:a,rules:x},{default:o(()=>[t(d,{prop:"name",label:"商品名","label-width":p},{default:o(()=>[t(n,{modelValue:a.name,"onUpdate:modelValue":l[0]||(l[0]=e=>a.name=e),modelModifiers:{trim:!0},maxlength:"20",placeholder:"商品名"},null,8,["modelValue"])]),_:1}),t(d,{prop:"status",label:"商品狀態","label-width":p},{default:o(()=>[t(P,{modelValue:a.status,"onUpdate:modelValue":l[1]||(l[1]=e=>a.status=e)},{default:o(()=>[t(U,{border:"",label:"0"},{default:o(()=>[k("停用")]),_:1}),t(U,{border:"",label:"1"},{default:o(()=>[k("啟用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{prop:"type",label:"商品類別","label-width":p},{default:o(()=>[t(D,{modelValue:a.type,"onUpdate:modelValue":l[2]||(l[2]=e=>a.type=e),placeholder:"類別",class:"w-full",onChange:l[3]||(l[3]=e=>y(e))},{default:o(()=>[(m(!0),h(R,null,L(E.value,(e,b)=>(m(),C(z,{key:b,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{prop:"describe",label:"商品描述","label-width":p},{default:o(()=>[t(n,{modelValue:a.describe,"onUpdate:modelValue":l[4]||(l[4]=e=>a.describe=e),modelModifiers:{trim:!0},maxlength:"20",placeholder:"商品描述"},null,8,["modelValue"])]),_:1}),t(d,{prop:"cost",label:"商品成本","label-width":p},{default:o(()=>[t(n,{modelValue:a.cost,"onUpdate:modelValue":l[5]||(l[5]=e=>a.cost=e),modelModifiers:{trim:!0},placeholder:"商品成本"},null,8,["modelValue"])]),_:1}),t(d,{prop:"retail",label:"商品售價","label-width":p},{default:o(()=>[t(n,{modelValue:a.retail,"onUpdate:modelValue":l[6]||(l[6]=e=>a.retail=e),modelModifiers:{trim:!0},placeholder:"商品售價"},null,8,["modelValue"])]),_:1}),t(d,{prop:"discount",label:"商品折扣","label-width":p},{default:o(()=>[t(n,{modelValue:a.discount,"onUpdate:modelValue":l[7]||(l[7]=e=>a.discount=e),modelModifiers:{trim:!0},placeholder:"商品折扣"},null,8,["modelValue"])]),_:1}),t(d,{prop:"directions",label:"包裝說明","label-width":p},{default:o(()=>[t(n,{modelValue:a.directions,"onUpdate:modelValue":l[8]||(l[8]=e=>a.directions=e),modelModifiers:{trim:!0},type:"textarea",maxlength:"50",placeholder:"包裝說明"},null,8,["modelValue"])]),_:1}),t(d,{prop:"preserve",label:"保存方式","label-width":p},{default:o(()=>[t(n,{modelValue:a.preserve,"onUpdate:modelValue":l[9]||(l[9]=e=>a.preserve=e),modelModifiers:{trim:!0},type:"textarea",maxlength:"50",placeholder:"保存方式"},null,8,["modelValue"])]),_:1}),t(d,{prop:"weight",label:"重量","label-width":p},{default:o(()=>[t(n,{modelValue:a.weight,"onUpdate:modelValue":l[10]||(l[10]=e=>a.weight=e),modelModifiers:{trim:!0},maxlength:"20",placeholder:"重量"},null,8,["modelValue"])]),_:1}),t(d,{prop:"ingredient",label:"成份","label-width":p},{default:o(()=>[t(n,{modelValue:a.ingredient,"onUpdate:modelValue":l[11]||(l[11]=e=>a.ingredient=e),modelModifiers:{trim:!0},type:"textarea",maxlength:"50",placeholder:"成份"},null,8,["modelValue"])]),_:1}),t(d,{prop:"nutritionFacts",label:"營養標示","label-width":p},{default:o(()=>[t(n,{modelValue:a.nutritionFacts,"onUpdate:modelValue":l[12]||(l[12]=e=>a.nutritionFacts=e),modelModifiers:{trim:!0},type:"textarea",maxlength:"50",placeholder:"營養標示"},null,8,["modelValue"])]),_:1}),t(d,{prop:"exp",label:"保存期限","label-width":p},{default:o(()=>[t(n,{modelValue:a.exp,"onUpdate:modelValue":l[13]||(l[13]=e=>a.exp=e),modelModifiers:{trim:!0},maxlength:"20",placeholder:"保存期限"},null,8,["modelValue"])]),_:1}),t(d,{prop:"popular",label:"設置熱門商品","label-width":p},{default:o(()=>[t(P,{modelValue:a.popular,"onUpdate:modelValue":l[14]||(l[14]=e=>a.popular=e)},{default:o(()=>[t(U,{border:"",label:!0},{default:o(()=>[k("是")]),_:1}),t(U,{border:"",label:!1},{default:o(()=>[k("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{prop:"style",label:"樣式","label-width":p},{default:o(()=>[t(D,{modelValue:a.style,"onUpdate:modelValue":l[15]||(l[15]=e=>a.style=e),placeholder:"樣式",class:"w-full"},{default:o(()=>[(m(!0),h(R,null,L(N.value,(e,b)=>(m(),C(z,{key:b,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{prop:"order",label:"排序","label-width":p},{default:o(()=>[t(n,{modelValue:a.order,"onUpdate:modelValue":l[16]||(l[16]=e=>a.order=e),modelModifiers:{trim:!0},type:"number",maxlength:"5",placeholder:"排序"},null,8,["modelValue"])]),_:1}),t(d,{prop:"remark",label:"備註","label-width":p},{default:o(()=>[t(n,{modelValue:a.remark,"onUpdate:modelValue":l[17]||(l[17]=e=>a.remark=e),modelModifiers:{trim:!0},type:"textarea",maxlength:"50",placeholder:"備註"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}};const oe={class:"container mx-auto my-5 p-5"},re={class:"flex justify-end my-3"},ie={key:2},ne=["src"],se={key:3,class:"one-line"},de={key:4,class:"one-line"},ue={key:5,class:"one-line"},ge={__name:"ProductList",setup(A){const M=v(!1),i=v({currentPage:1,total:1,pageSize:5,pageSizes:[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper"}),S=()=>{const r=y.filter((s,e)=>e<i.value.pageSize);N.value=r},O=()=>{i.value.total=y.length,S(),M.value=!0},H=r=>{i.value.currentPage=1,i.value.pageSize=r,S()},a=r=>{let s=i.value.pageSize*(r-1),e=i.value.pageSize*r,b=[];for(let V=s;V<e;V++)y[V]&&b.push(y[V]);N.value=b,i.value.currentPage=r},w=v(!1),B=v(""),x=v(null),E=v([{prop:"status",label:"狀態",width:80,fexid:!1,align:"center"},{prop:"type",label:"類別",width:120,fexid:!1,align:"center"},{prop:"name",label:"品名",width:150,fexid:!1,align:"center"},{prop:"describe",label:"商品描述",width:100,fexid:!1,align:"center"},{prop:"cost",label:"成本售價",width:120,fexid:!1,align:"right"},{prop:"retail",label:"零售價格",width:120,fexid:!1,align:"center"},{prop:"discount",label:"折扣金額",width:"auto",fexid:!1,align:"center"},{prop:"directions",label:"包裝說明",width:120,fexid:!1,align:"center"},{prop:"preserve",label:"保存方式",width:120,fexid:!1,align:"center"},{prop:"weight",label:"重量",width:120,fexid:!1,align:"center"},{prop:"ingredient",label:"成份",width:120,fexid:!1,align:"center"},{prop:"nutritionFacts",label:"營養標示",width:120,fexid:!1,align:"center"},{prop:"exp",label:"保存期限",width:120,fexid:!1,align:"center"},{prop:"img",label:"圖片",width:120,fexid:!1,align:"center"},{prop:"popular",label:"熱門商品",width:80,fexid:!1,align:"center"},{prop:"style",label:"樣式",width:80,fexid:!1,align:"center"},{prop:"order",label:"排序",width:120,fexid:!1,align:"right"},{prop:"remark",label:"備註",width:120,fexid:!1,align:"center"}]),N=v([]);let y=[];const $=()=>{q.get("/api/products").then(r=>{console.log(r),r.data.msg?c.error(`資料取得失敗！ ${r.data.msg}`):(y=r.data,O())}).catch(r=>{console.log(r),c.error(`錯誤！ ${r.message}`)})},j=r=>{const s=JSON.parse(JSON.stringify(r));console.log(s),x.value._id,q.post("/api/products/edit/"+x.value._id,r).then(e=>{console.log(e),e.data.msg?c.error(`更新失敗！ ${e.data.msg}`):(c({message:"更新成功",type:"success"}),w.value=!1,$())}).catch(e=>{console.log(e),c.error(`錯誤！ ${e.message}`)})},f=r=>{const s=JSON.parse(JSON.stringify(r));console.log(s),q.post("/api/products/add",r).then(e=>{console.log(e),e.data.msg?c.error(`新增失敗！ ${e.data.msg}`):(c({message:"新增成功",type:"success"}),w.value=!1,$())}).catch(e=>{console.log(e),c.error(`新增失敗！ ${e.message}`)})},l=r=>{q.delete("/api/products/delete/"+r).then(s=>{console.log(s),s.data.msg?c.error(`刪除失敗！ ${s.data.msg}`):(c({message:"刪除成功",type:"success"}),$())}).catch(s=>{console.log(s),c.error(`刪除失敗！ ${s.message}`)})},n=r=>{switch(r){case"pro_dripBagBag":return Z;case"pro_dripBagPacket":return ee;case"pro_singleOrigin":return le}return null},d=(r,s)=>{const e=JSON.parse(JSON.stringify(s));x.value=e,console.log(e),X.confirm(`是否刪除 ${e.name}?`,"警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(()=>{l(e._id)}).catch(()=>{})},U=(r,s)=>{console.log(8),B.value="編輯商品";const e=JSON.parse(JSON.stringify(s));x.value=e,w.value=!0,console.log(5)},P=()=>{B.value="新增商品",x.value=null,w.value=!0},z=()=>{w.value=!1},D=r=>`tag-color-${r}`,I=r=>{switch(r){case"0":return"停用";case"1":return"啟用"}};return $(),(r,s)=>{var W;const e=g("el-button"),b=g("el-table-column"),V=g("el-tooltip"),Q=g("el-table");return m(),h("main",oe,[T("div",re,[t(e,{icon:"Plus",onClick:P},{default:o(()=>[k("新增")]),_:1})]),T("div",null,[((W=N.value)==null?void 0:W.length)>0?(m(),C(Q,{key:0,stripe:"",data:N.value},{default:o(()=>[t(b,{type:"index",label:""}),(m(!0),h(R,null,L(E.value,u=>(m(),C(b,{key:u.prop,fixed:u.fixed,prop:u.prop,label:u.label,width:u.width,align:u.align},{default:o(_=>[u.prop==="style"?(m(),h("span",{key:0,class:K(D(_.row.style)+" text-white p-2")},F(_.row.style),3)):u.prop==="status"?(m(),h("span",{key:1,class:K(_.row.status===1?"text-green-600":"text-slate-400")},F(I(_.row.status)),3)):u.prop==="img"?(m(),h("div",ie,[T("img",{src:n(_.row.img)},null,8,ne)])):u.prop==="directions"?(m(),h("span",se,F(_.row.directions),1)):u.prop==="preserve"?(m(),h("span",de,F(_.row.preserve),1)):u.prop==="ingredient"?(m(),h("span",ue,F(_.row.ingredient),1)):J("",!0)]),_:2},1032,["fixed","prop","label","width","align"]))),128)),t(b,{fixed:"right",label:"功能",width:"130",align:"center"},{default:o(u=>[t(V,{content:"編輯",placement:"top"},{default:o(()=>[t(e,{type:"primary",icon:"Edit",circle:"",onClick:_=>U(u.$index,u.row)},null,8,["onClick"])]),_:2},1024),t(V,{content:"刪除",placement:"top"},{default:o(()=>[t(e,{type:"danger",icon:"DeleteFilled",circle:"",onClick:_=>d(u.$index,u.row)},null,8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])):J("",!0),M.value?(m(),C(Y,{key:1,pagination:i.value,onSizeChange:H,onCurrentChange:a},null,8,["pagination"])):J("",!0)]),w.value?(m(),C(ae,{key:0,visible:w.value,title:B.value,data:x.value,onClose:z,onSubmitAdd:f,onSubmitEdit:j},null,8,["visible","title","data"])):J("",!0)])}}};export{ge as default};
